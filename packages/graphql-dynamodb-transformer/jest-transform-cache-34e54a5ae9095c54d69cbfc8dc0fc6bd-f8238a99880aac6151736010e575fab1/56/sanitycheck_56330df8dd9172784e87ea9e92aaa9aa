efcfe83817b55649a7ceed3b5aec87f3
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.cantHaveMoreThan200Resources = exports.cantEditLSIKeySchema = exports.cantAddAndRemoveGSIAtSameTime = exports.cantEditGSIKeySchema = exports.cantAddLSILater = exports.cantEditKeySchema = exports.check = void 0;

const fs = require('fs-extra');

const path_1 = require("path");

const deep_diff_1 = require("deep-diff");

const fileUtils_1 = require("./fileUtils");

const errors_1 = require("../errors");

const __1 = require("..");

async function check(currentCloudBackendDir, buildDirectory, rootStackName = 'cloudformation-template.json') {
  const cloudBackendDirectoryExists = await fs.exists(currentCloudBackendDir);
  const buildDirectoryExists = await fs.exists(buildDirectory);
  const diffRules = [cantEditKeySchema, cantAddLSILater, cantEditGSIKeySchema, cantEditLSIKeySchema, cantAddAndRemoveGSIAtSameTime];
  const projectRules = [cantHaveMoreThan200Resources];

  if (cloudBackendDirectoryExists && buildDirectoryExists) {
    const current = await loadDiffableProject(currentCloudBackendDir, rootStackName);
    const next = await loadDiffableProject(buildDirectory, rootStackName);
    const diffs = deep_diff_1.diff(current, next);

    if (diffs) {
      for (const diff of diffs) {
        for (const rule of diffRules) {
          rule(diff, current, next);
        }
      }

      for (const projectRule of projectRules) {
        projectRule(diffs, current, next);
      }
    }
  }
}

exports.check = check;

function cantEditKeySchema(diff) {
  if (diff.kind === 'E' && diff.path.length === 8 && diff.path[5] === 'KeySchema') {
    const stackName = path_1.basename(diff.path[1], '.json');
    const tableName = diff.path[3];
    throw new errors_1.InvalidMigrationError(`Attempting to edit the key schema of the ${tableName} table in the ${stackName} stack. `, 'Adding a primary @key directive to an existing @model. ', 'Remove the @key directive or provide a name e.g @key(name: "ByStatus", fields: ["status"]).');
  }
}

exports.cantEditKeySchema = cantEditKeySchema;

function cantAddLSILater(diff) {
  if (diff.kind === 'N' && diff.path.length === 6 && diff.path[5] === 'LocalSecondaryIndexes' || diff.kind === 'A' && diff.path.length === 6 && diff.path[5] === 'LocalSecondaryIndexes' && diff.item.kind === 'N') {
    const stackName = path_1.basename(diff.path[1], '.json');
    const tableName = diff.path[3];
    throw new errors_1.InvalidMigrationError(`Attempting to add a local secondary index to the ${tableName} table in the ${stackName} stack. ` + 'Local secondary indexes must be created when the table is created.', "Adding a @key directive where the first field in 'fields' is the same as the first field in the 'fields' of the primary @key.", "Change the first field in 'fields' such that a global secondary index is created or delete and recreate the model.");
  }
}

exports.cantAddLSILater = cantAddLSILater;

function cantEditGSIKeySchema(diff, currentBuild, nextBuild) {
  function throwError(indexName, stackName, tableName) {
    throw new errors_1.InvalidMigrationError(`Attempting to edit the global secondary index ${indexName} on the ${tableName} table in the ${stackName} stack. `, 'The key schema of a global secondary index cannot be changed after being deployed.', 'If using @key, first add a new @key, run `amplify push`, ' + 'and then remove the old @key. If using @connection, first remove the @connection, run `amplify push`, ' + 'and then add the new @connection with the new configuration.');
  }

  if (diff.kind === 'E' && diff.path.length === 10 && diff.path[5] === 'GlobalSecondaryIndexes' && diff.path[7] === 'KeySchema' || diff.kind === 'A' && diff.path.length === 8 && diff.path[5] === 'GlobalSecondaryIndexes' && diff.path[7] === 'KeySchema') {
    const pathToGSIs = diff.path.slice(0, 6);
    const oldIndexes = get(currentBuild, pathToGSIs);
    const newIndexes = get(nextBuild, pathToGSIs);
    const oldIndexesDiffable = keyBy(oldIndexes, 'IndexName');
    const newIndexesDiffable = keyBy(newIndexes, 'IndexName');
    const innerDiffs = deep_diff_1.diff(oldIndexesDiffable, newIndexesDiffable);

    for (const innerDiff of innerDiffs) {
      if (innerDiff.kind === 'E' && innerDiff.path.length > 2 && innerDiff.path[1] === 'KeySchema') {
        const indexName = innerDiff.path[0];
        const stackName = path_1.basename(diff.path[1], '.json');
        const tableName = diff.path[3];
        throwError(indexName, stackName, tableName);
      } else if (innerDiff.kind === 'A' && innerDiff.path.length === 2 && innerDiff.path[1] === 'KeySchema') {
        const indexName = innerDiff.path[0];
        const stackName = path_1.basename(diff.path[1], '.json');
        const tableName = diff.path[3];
        throwError(indexName, stackName, tableName);
      }
    }
  }
}

exports.cantEditGSIKeySchema = cantEditGSIKeySchema;

function cantAddAndRemoveGSIAtSameTime(diff, currentBuild, nextBuild) {
  function throwError(stackName, tableName) {
    throw new errors_1.InvalidMigrationError(`Attempting to add and remove a global secondary index at the same time on the ${tableName} table in the ${stackName} stack. `, 'You may only change one global secondary index in a single CloudFormation stack update. ', 'If using @key, change one @key at a time. ' + 'If using @connection, add the new @connection, run `amplify push`, ' + 'and then remove the new @connection with the new configuration.');
  }

  if (diff.kind === 'E' && diff.path.length > 6 && diff.path[5] === 'GlobalSecondaryIndexes') {
    const pathToGSIs = diff.path.slice(0, 6);
    const oldIndexes = get(currentBuild, pathToGSIs);
    const newIndexes = get(nextBuild, pathToGSIs);
    const oldIndexesDiffable = keyBy(oldIndexes, 'IndexName');
    const newIndexesDiffable = keyBy(newIndexes, 'IndexName');
    const innerDiffs = deep_diff_1.diff(oldIndexesDiffable, newIndexesDiffable);
    let sawDelete = false;
    let sawNew = false;

    for (const diff of innerDiffs) {
      if (diff.path.length === 1 && diff.kind === 'D') {
        sawDelete = true;
      }

      if (diff.path.length === 1 && diff.kind === 'N') {
        sawNew = true;
      }
    }

    if (sawDelete && sawNew) {
      const stackName = path_1.basename(diff.path[1], '.json');
      const tableName = diff.path[3];
      throwError(stackName, tableName);
    }
  }
}

exports.cantAddAndRemoveGSIAtSameTime = cantAddAndRemoveGSIAtSameTime;

function cantEditLSIKeySchema(diff, currentBuild, nextBuild) {
  if (diff.kind === 'E' && diff.path.length === 10 && diff.path[5] === 'LocalSecondaryIndexes' && diff.path[7] === 'KeySchema') {
    const pathToGSIs = diff.path.slice(0, 6);
    const oldIndexes = get(currentBuild, pathToGSIs);
    const newIndexes = get(nextBuild, pathToGSIs);
    const oldIndexesDiffable = keyBy(oldIndexes, 'IndexName');
    const newIndexesDiffable = keyBy(newIndexes, 'IndexName');
    const innerDiffs = deep_diff_1.diff(oldIndexesDiffable, newIndexesDiffable);

    for (const innerDiff of innerDiffs) {
      if (innerDiff.kind === 'E' && innerDiff.path.length > 2 && innerDiff.path[1] === 'KeySchema') {
        const indexName = innerDiff.path[0];
        const stackName = path_1.basename(diff.path[1], '.json');
        const tableName = diff.path[3];
        throw new errors_1.InvalidMigrationError(`Attempting to edit the local secondary index ${indexName} on the ${tableName} table in the ${stackName} stack. `, 'The key schema of a local secondary index cannot be changed after being deployed.', 'When enabling new access patterns you should: 1. Add a new @key 2. run amplify push ' + '3. Verify the new access pattern and remove the old @key.');
      }
    }
  }
}

exports.cantEditLSIKeySchema = cantEditLSIKeySchema;

function cantHaveMoreThan200Resources(diffs, currentBuild, nextBuild) {
  const stackKeys = Object.keys(nextBuild.stacks);

  for (const stackName of stackKeys) {
    const stack = nextBuild.stacks[stackName];

    if (stack && stack.Resources && Object.keys(stack.Resources).length > 200) {
      throw new errors_1.InvalidMigrationError(`The ${stackName} stack defines more than 200 resources.`, 'CloudFormation templates may contain at most 200 resources.', 'If the stack is a custom stack, break the stack up into multiple files in stacks/. ' + 'If the stack was generated, you have hit a limit and can use the StackMapping argument in ' + `${__1.TRANSFORM_CONFIG_FILE_NAME} to fine tune how resources are assigned to stacks.`);
    }
  }
}

exports.cantHaveMoreThan200Resources = cantHaveMoreThan200Resources;

function keyBy(objects, attr) {
  return objects.reduce((acc, obj) => ({ ...acc,
    [obj[attr]]: obj
  }), {});
}

async function loadDiffableProject(path, rootStackName) {
  const project = await fileUtils_1.readFromPath(path);
  const currentStacks = project.stacks || {};
  const diffableProject = {
    stacks: {},
    root: {}
  };

  for (const key of Object.keys(currentStacks)) {
    diffableProject.stacks[key] = JSON.parse(project.stacks[key]);
  }

  diffableProject.root = JSON.parse(project[rootStackName]);
  return diffableProject;
}

function get(obj, path) {
  let tmp = obj;

  for (const part of path) {
    tmp = tmp[part];

    if (!tmp) {
      return undefined;
    }
  }

  return tmp;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy91dGlsL3Nhbml0eS1jaGVjay50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUEsTUFBTSxFQUFFLEdBQUcsT0FBTyxDQUFDLFVBQUQsQ0FBbEI7O0FBQ0EsTUFBQSxNQUFBLEdBQUEsT0FBQSxDQUFBLE1BQUEsQ0FBQTs7QUFDQSxNQUFBLFdBQUEsR0FBQSxPQUFBLENBQUEsV0FBQSxDQUFBOztBQUNBLE1BQUEsV0FBQSxHQUFBLE9BQUEsQ0FBQSxhQUFBLENBQUE7O0FBQ0EsTUFBQSxRQUFBLEdBQUEsT0FBQSxDQUFBLFdBQUEsQ0FBQTs7QUFFQSxNQUFBLEdBQUEsR0FBQSxPQUFBLENBQUEsSUFBQSxDQUFBOztBQWVPLGVBQWUsS0FBZixDQUNMLHNCQURLLEVBRUwsY0FGSyxFQUdMLGFBQUEsR0FBd0IsOEJBSG5CLEVBR2lEO0FBRXRELFFBQU0sMkJBQTJCLEdBQUcsTUFBTSxFQUFFLENBQUMsTUFBSCxDQUFVLHNCQUFWLENBQTFDO0FBQ0EsUUFBTSxvQkFBb0IsR0FBRyxNQUFNLEVBQUUsQ0FBQyxNQUFILENBQVUsY0FBVixDQUFuQztBQUdBLFFBQU0sU0FBUyxHQUFlLENBQzVCLGlCQUQ0QixFQUU1QixlQUY0QixFQUc1QixvQkFINEIsRUFJNUIsb0JBSjRCLEVBSzVCLDZCQUw0QixDQUE5QjtBQVFBLFFBQU0sWUFBWSxHQUFrQixDQUFDLDRCQUFELENBQXBDOztBQUNBLE1BQUksMkJBQTJCLElBQUksb0JBQW5DLEVBQXlEO0FBQ3ZELFVBQU0sT0FBTyxHQUFHLE1BQU0sbUJBQW1CLENBQUMsc0JBQUQsRUFBeUIsYUFBekIsQ0FBekM7QUFDQSxVQUFNLElBQUksR0FBRyxNQUFNLG1CQUFtQixDQUFDLGNBQUQsRUFBaUIsYUFBakIsQ0FBdEM7QUFDQSxVQUFNLEtBQUssR0FBRyxXQUFBLENBQUEsSUFBQSxDQUFTLE9BQVQsRUFBa0IsSUFBbEIsQ0FBZDs7QUFHQSxRQUFJLEtBQUosRUFBVztBQUNULFdBQUssTUFBTSxJQUFYLElBQW1CLEtBQW5CLEVBQTBCO0FBQ3hCLGFBQUssTUFBTSxJQUFYLElBQW1CLFNBQW5CLEVBQThCO0FBQzVCLFVBQUEsSUFBSSxDQUFDLElBQUQsRUFBTyxPQUFQLEVBQWdCLElBQWhCLENBQUo7QUFDRDtBQUNGOztBQUNELFdBQUssTUFBTSxXQUFYLElBQTBCLFlBQTFCLEVBQXdDO0FBQ3RDLFFBQUEsV0FBVyxDQUFDLEtBQUQsRUFBUSxPQUFSLEVBQWlCLElBQWpCLENBQVg7QUFDRDtBQUNGO0FBQ0Y7QUFDRjs7QUFuQ0QsT0FBQSxDQUFBLEtBQUEsR0FBQSxLQUFBOztBQWtEQSxTQUFnQixpQkFBaEIsQ0FBa0MsSUFBbEMsRUFBNEM7QUFDMUMsTUFBSSxJQUFJLENBQUMsSUFBTCxLQUFjLEdBQWQsSUFBcUIsSUFBSSxDQUFDLElBQUwsQ0FBVSxNQUFWLEtBQXFCLENBQTFDLElBQStDLElBQUksQ0FBQyxJQUFMLENBQVUsQ0FBVixNQUFpQixXQUFwRSxFQUFpRjtBQUUvRSxVQUFNLFNBQVMsR0FBRyxNQUFBLENBQUEsUUFBQSxDQUFTLElBQUksQ0FBQyxJQUFMLENBQVUsQ0FBVixDQUFULEVBQXVCLE9BQXZCLENBQWxCO0FBQ0EsVUFBTSxTQUFTLEdBQUcsSUFBSSxDQUFDLElBQUwsQ0FBVSxDQUFWLENBQWxCO0FBQ0EsVUFBTSxJQUFJLFFBQUEsQ0FBQSxxQkFBSixDQUNKLDRDQUE0QyxTQUFTLGlCQUFpQixTQUFTLFVBRDNFLEVBRUoseURBRkksRUFHSiw2RkFISSxDQUFOO0FBS0Q7QUFDRjs7QUFYRCxPQUFBLENBQUEsaUJBQUEsR0FBQSxpQkFBQTs7QUFvQkEsU0FBZ0IsZUFBaEIsQ0FBZ0MsSUFBaEMsRUFBMEM7QUFDeEMsTUFFRyxJQUFJLENBQUMsSUFBTCxLQUFjLEdBQWQsSUFBcUIsSUFBSSxDQUFDLElBQUwsQ0FBVSxNQUFWLEtBQXFCLENBQTFDLElBQStDLElBQUksQ0FBQyxJQUFMLENBQVUsQ0FBVixNQUFpQix1QkFBakUsSUFFQyxJQUFJLENBQUMsSUFBTCxLQUFjLEdBQWQsSUFBcUIsSUFBSSxDQUFDLElBQUwsQ0FBVSxNQUFWLEtBQXFCLENBQTFDLElBQStDLElBQUksQ0FBQyxJQUFMLENBQVUsQ0FBVixNQUFpQix1QkFBaEUsSUFBMkYsSUFBSSxDQUFDLElBQUwsQ0FBVSxJQUFWLEtBQW1CLEdBSmpILEVBS0U7QUFFQSxVQUFNLFNBQVMsR0FBRyxNQUFBLENBQUEsUUFBQSxDQUFTLElBQUksQ0FBQyxJQUFMLENBQVUsQ0FBVixDQUFULEVBQXVCLE9BQXZCLENBQWxCO0FBQ0EsVUFBTSxTQUFTLEdBQUcsSUFBSSxDQUFDLElBQUwsQ0FBVSxDQUFWLENBQWxCO0FBQ0EsVUFBTSxJQUFJLFFBQUEsQ0FBQSxxQkFBSixDQUNKLG9EQUFvRCxTQUFTLGlCQUFpQixTQUFTLFVBQXZGLEdBQ0Usb0VBRkUsRUFHSiwrSEFISSxFQUlKLG9IQUpJLENBQU47QUFNRDtBQUNGOztBQWpCRCxPQUFBLENBQUEsZUFBQSxHQUFBLGVBQUE7O0FBMEJBLFNBQWdCLG9CQUFoQixDQUFxQyxJQUFyQyxFQUFpRCxZQUFqRCxFQUFnRixTQUFoRixFQUEwRztBQUN4RyxXQUFTLFVBQVQsQ0FBb0IsU0FBcEIsRUFBdUMsU0FBdkMsRUFBMEQsU0FBMUQsRUFBMkU7QUFDekUsVUFBTSxJQUFJLFFBQUEsQ0FBQSxxQkFBSixDQUNKLGlEQUFpRCxTQUFTLFdBQVcsU0FBUyxpQkFBaUIsU0FBUyxVQURwRyxFQUVKLG9GQUZJLEVBR0osOERBQ0Usd0dBREYsR0FFRSw4REFMRSxDQUFOO0FBT0Q7O0FBQ0QsTUFHRyxJQUFJLENBQUMsSUFBTCxLQUFjLEdBQWQsSUFBcUIsSUFBSSxDQUFDLElBQUwsQ0FBVSxNQUFWLEtBQXFCLEVBQTFDLElBQWdELElBQUksQ0FBQyxJQUFMLENBQVUsQ0FBVixNQUFpQix3QkFBakUsSUFBNkYsSUFBSSxDQUFDLElBQUwsQ0FBVSxDQUFWLE1BQWlCLFdBQS9HLElBR0MsSUFBSSxDQUFDLElBQUwsS0FBYyxHQUFkLElBQXFCLElBQUksQ0FBQyxJQUFMLENBQVUsTUFBVixLQUFxQixDQUExQyxJQUErQyxJQUFJLENBQUMsSUFBTCxDQUFVLENBQVYsTUFBaUIsd0JBQWhFLElBQTRGLElBQUksQ0FBQyxJQUFMLENBQVUsQ0FBVixNQUFpQixXQU5oSCxFQU9FO0FBRUEsVUFBTSxVQUFVLEdBQUcsSUFBSSxDQUFDLElBQUwsQ0FBVSxLQUFWLENBQWdCLENBQWhCLEVBQW1CLENBQW5CLENBQW5CO0FBQ0EsVUFBTSxVQUFVLEdBQUcsR0FBRyxDQUFDLFlBQUQsRUFBZSxVQUFmLENBQXRCO0FBQ0EsVUFBTSxVQUFVLEdBQUcsR0FBRyxDQUFDLFNBQUQsRUFBWSxVQUFaLENBQXRCO0FBQ0EsVUFBTSxrQkFBa0IsR0FBRyxLQUFLLENBQUMsVUFBRCxFQUFhLFdBQWIsQ0FBaEM7QUFDQSxVQUFNLGtCQUFrQixHQUFHLEtBQUssQ0FBQyxVQUFELEVBQWEsV0FBYixDQUFoQztBQUNBLFVBQU0sVUFBVSxHQUFHLFdBQUEsQ0FBQSxJQUFBLENBQVMsa0JBQVQsRUFBNkIsa0JBQTdCLENBQW5COztBQUtBLFNBQUssTUFBTSxTQUFYLElBQXdCLFVBQXhCLEVBQW9DO0FBRWxDLFVBQUksU0FBUyxDQUFDLElBQVYsS0FBbUIsR0FBbkIsSUFBMEIsU0FBUyxDQUFDLElBQVYsQ0FBZSxNQUFmLEdBQXdCLENBQWxELElBQXVELFNBQVMsQ0FBQyxJQUFWLENBQWUsQ0FBZixNQUFzQixXQUFqRixFQUE4RjtBQUM1RixjQUFNLFNBQVMsR0FBRyxTQUFTLENBQUMsSUFBVixDQUFlLENBQWYsQ0FBbEI7QUFDQSxjQUFNLFNBQVMsR0FBRyxNQUFBLENBQUEsUUFBQSxDQUFTLElBQUksQ0FBQyxJQUFMLENBQVUsQ0FBVixDQUFULEVBQXVCLE9BQXZCLENBQWxCO0FBQ0EsY0FBTSxTQUFTLEdBQUcsSUFBSSxDQUFDLElBQUwsQ0FBVSxDQUFWLENBQWxCO0FBQ0EsUUFBQSxVQUFVLENBQUMsU0FBRCxFQUFZLFNBQVosRUFBdUIsU0FBdkIsQ0FBVjtBQUNELE9BTEQsTUFLTyxJQUFJLFNBQVMsQ0FBQyxJQUFWLEtBQW1CLEdBQW5CLElBQTBCLFNBQVMsQ0FBQyxJQUFWLENBQWUsTUFBZixLQUEwQixDQUFwRCxJQUF5RCxTQUFTLENBQUMsSUFBVixDQUFlLENBQWYsTUFBc0IsV0FBbkYsRUFBZ0c7QUFFckcsY0FBTSxTQUFTLEdBQUcsU0FBUyxDQUFDLElBQVYsQ0FBZSxDQUFmLENBQWxCO0FBQ0EsY0FBTSxTQUFTLEdBQUcsTUFBQSxDQUFBLFFBQUEsQ0FBUyxJQUFJLENBQUMsSUFBTCxDQUFVLENBQVYsQ0FBVCxFQUF1QixPQUF2QixDQUFsQjtBQUNBLGNBQU0sU0FBUyxHQUFHLElBQUksQ0FBQyxJQUFMLENBQVUsQ0FBVixDQUFsQjtBQUNBLFFBQUEsVUFBVSxDQUFDLFNBQUQsRUFBWSxTQUFaLEVBQXVCLFNBQXZCLENBQVY7QUFDRDtBQUNGO0FBQ0Y7QUFDRjs7QUE3Q0QsT0FBQSxDQUFBLG9CQUFBLEdBQUEsb0JBQUE7O0FBc0RBLFNBQWdCLDZCQUFoQixDQUE4QyxJQUE5QyxFQUEwRCxZQUExRCxFQUF5RixTQUF6RixFQUFtSDtBQUNqSCxXQUFTLFVBQVQsQ0FBb0IsU0FBcEIsRUFBdUMsU0FBdkMsRUFBd0Q7QUFDdEQsVUFBTSxJQUFJLFFBQUEsQ0FBQSxxQkFBSixDQUNKLGlGQUFpRixTQUFTLGlCQUFpQixTQUFTLFVBRGhILEVBRUosMEZBRkksRUFHSiwrQ0FDRSxxRUFERixHQUVFLGlFQUxFLENBQU47QUFPRDs7QUFDRCxNQUdFLElBQUksQ0FBQyxJQUFMLEtBQWMsR0FBZCxJQUNBLElBQUksQ0FBQyxJQUFMLENBQVUsTUFBVixHQUFtQixDQURuQixJQUVBLElBQUksQ0FBQyxJQUFMLENBQVUsQ0FBVixNQUFpQix3QkFMbkIsRUFNRTtBQUVBLFVBQU0sVUFBVSxHQUFHLElBQUksQ0FBQyxJQUFMLENBQVUsS0FBVixDQUFnQixDQUFoQixFQUFtQixDQUFuQixDQUFuQjtBQUNBLFVBQU0sVUFBVSxHQUFHLEdBQUcsQ0FBQyxZQUFELEVBQWUsVUFBZixDQUF0QjtBQUNBLFVBQU0sVUFBVSxHQUFHLEdBQUcsQ0FBQyxTQUFELEVBQVksVUFBWixDQUF0QjtBQUNBLFVBQU0sa0JBQWtCLEdBQUcsS0FBSyxDQUFDLFVBQUQsRUFBYSxXQUFiLENBQWhDO0FBQ0EsVUFBTSxrQkFBa0IsR0FBRyxLQUFLLENBQUMsVUFBRCxFQUFhLFdBQWIsQ0FBaEM7QUFDQSxVQUFNLFVBQVUsR0FBRyxXQUFBLENBQUEsSUFBQSxDQUFTLGtCQUFULEVBQTZCLGtCQUE3QixDQUFuQjtBQUNBLFFBQUksU0FBUyxHQUFHLEtBQWhCO0FBQ0EsUUFBSSxNQUFNLEdBQUcsS0FBYjs7QUFDQSxTQUFLLE1BQU0sSUFBWCxJQUFtQixVQUFuQixFQUErQjtBQUU3QixVQUFJLElBQUksQ0FBQyxJQUFMLENBQVUsTUFBVixLQUFxQixDQUFyQixJQUEwQixJQUFJLENBQUMsSUFBTCxLQUFjLEdBQTVDLEVBQWlEO0FBQy9DLFFBQUEsU0FBUyxHQUFHLElBQVo7QUFDRDs7QUFDRCxVQUFJLElBQUksQ0FBQyxJQUFMLENBQVUsTUFBVixLQUFxQixDQUFyQixJQUEwQixJQUFJLENBQUMsSUFBTCxLQUFjLEdBQTVDLEVBQWlEO0FBQy9DLFFBQUEsTUFBTSxHQUFHLElBQVQ7QUFDRDtBQUNGOztBQUNELFFBQUksU0FBUyxJQUFJLE1BQWpCLEVBQXlCO0FBQ3ZCLFlBQU0sU0FBUyxHQUFHLE1BQUEsQ0FBQSxRQUFBLENBQVMsSUFBSSxDQUFDLElBQUwsQ0FBVSxDQUFWLENBQVQsRUFBdUIsT0FBdkIsQ0FBbEI7QUFDQSxZQUFNLFNBQVMsR0FBRyxJQUFJLENBQUMsSUFBTCxDQUFVLENBQVYsQ0FBbEI7QUFDQSxNQUFBLFVBQVUsQ0FBQyxTQUFELEVBQVksU0FBWixDQUFWO0FBQ0Q7QUFDRjtBQUNGOztBQXpDRCxPQUFBLENBQUEsNkJBQUEsR0FBQSw2QkFBQTs7QUFrREEsU0FBZ0Isb0JBQWhCLENBQXFDLElBQXJDLEVBQWlELFlBQWpELEVBQWdGLFNBQWhGLEVBQTBHO0FBQ3hHLE1BRUUsSUFBSSxDQUFDLElBQUwsS0FBYyxHQUFkLElBQ0EsSUFBSSxDQUFDLElBQUwsQ0FBVSxNQUFWLEtBQXFCLEVBRHJCLElBRUEsSUFBSSxDQUFDLElBQUwsQ0FBVSxDQUFWLE1BQWlCLHVCQUZqQixJQUdBLElBQUksQ0FBQyxJQUFMLENBQVUsQ0FBVixNQUFpQixXQUxuQixFQU1FO0FBRUEsVUFBTSxVQUFVLEdBQUcsSUFBSSxDQUFDLElBQUwsQ0FBVSxLQUFWLENBQWdCLENBQWhCLEVBQW1CLENBQW5CLENBQW5CO0FBQ0EsVUFBTSxVQUFVLEdBQUcsR0FBRyxDQUFDLFlBQUQsRUFBZSxVQUFmLENBQXRCO0FBQ0EsVUFBTSxVQUFVLEdBQUcsR0FBRyxDQUFDLFNBQUQsRUFBWSxVQUFaLENBQXRCO0FBQ0EsVUFBTSxrQkFBa0IsR0FBRyxLQUFLLENBQUMsVUFBRCxFQUFhLFdBQWIsQ0FBaEM7QUFDQSxVQUFNLGtCQUFrQixHQUFHLEtBQUssQ0FBQyxVQUFELEVBQWEsV0FBYixDQUFoQztBQUNBLFVBQU0sVUFBVSxHQUFHLFdBQUEsQ0FBQSxJQUFBLENBQVMsa0JBQVQsRUFBNkIsa0JBQTdCLENBQW5COztBQUtBLFNBQUssTUFBTSxTQUFYLElBQXdCLFVBQXhCLEVBQW9DO0FBRWxDLFVBQUksU0FBUyxDQUFDLElBQVYsS0FBbUIsR0FBbkIsSUFBMEIsU0FBUyxDQUFDLElBQVYsQ0FBZSxNQUFmLEdBQXdCLENBQWxELElBQXVELFNBQVMsQ0FBQyxJQUFWLENBQWUsQ0FBZixNQUFzQixXQUFqRixFQUE4RjtBQUM1RixjQUFNLFNBQVMsR0FBRyxTQUFTLENBQUMsSUFBVixDQUFlLENBQWYsQ0FBbEI7QUFDQSxjQUFNLFNBQVMsR0FBRyxNQUFBLENBQUEsUUFBQSxDQUFTLElBQUksQ0FBQyxJQUFMLENBQVUsQ0FBVixDQUFULEVBQXVCLE9BQXZCLENBQWxCO0FBQ0EsY0FBTSxTQUFTLEdBQUcsSUFBSSxDQUFDLElBQUwsQ0FBVSxDQUFWLENBQWxCO0FBQ0EsY0FBTSxJQUFJLFFBQUEsQ0FBQSxxQkFBSixDQUNKLGdEQUFnRCxTQUFTLFdBQVcsU0FBUyxpQkFBaUIsU0FBUyxVQURuRyxFQUVKLG1GQUZJLEVBR0oseUZBQ0UsMkRBSkUsQ0FBTjtBQU1EO0FBQ0Y7QUFDRjtBQUNGOztBQWxDRCxPQUFBLENBQUEsb0JBQUEsR0FBQSxvQkFBQTs7QUFvQ0EsU0FBZ0IsNEJBQWhCLENBQTZDLEtBQTdDLEVBQTRELFlBQTVELEVBQTJGLFNBQTNGLEVBQXFIO0FBQ25ILFFBQU0sU0FBUyxHQUFHLE1BQU0sQ0FBQyxJQUFQLENBQVksU0FBUyxDQUFDLE1BQXRCLENBQWxCOztBQUNBLE9BQUssTUFBTSxTQUFYLElBQXdCLFNBQXhCLEVBQW1DO0FBQ2pDLFVBQU0sS0FBSyxHQUFHLFNBQVMsQ0FBQyxNQUFWLENBQWlCLFNBQWpCLENBQWQ7O0FBQ0EsUUFBSSxLQUFLLElBQUksS0FBSyxDQUFDLFNBQWYsSUFBNEIsTUFBTSxDQUFDLElBQVAsQ0FBWSxLQUFLLENBQUMsU0FBbEIsRUFBNkIsTUFBN0IsR0FBc0MsR0FBdEUsRUFBMkU7QUFDekUsWUFBTSxJQUFJLFFBQUEsQ0FBQSxxQkFBSixDQUNKLE9BQU8sU0FBUyx5Q0FEWixFQUVKLDZEQUZJLEVBR0osd0ZBQ0UsNEZBREYsR0FFRSxHQUFHLEdBQUEsQ0FBQSwwQkFBMEIscURBTDNCLENBQU47QUFPRDtBQUNGO0FBQ0Y7O0FBZEQsT0FBQSxDQUFBLDRCQUFBLEdBQUEsNEJBQUE7O0FBa0JBLFNBQVMsS0FBVCxDQUFlLE9BQWYsRUFBK0IsSUFBL0IsRUFBMkM7QUFDekMsU0FBTyxPQUFPLENBQUMsTUFBUixDQUNMLENBQUMsR0FBRCxFQUFNLEdBQU4sTUFBZSxFQUNiLEdBQUcsR0FEVTtBQUViLEtBQUMsR0FBRyxDQUFDLElBQUQsQ0FBSixHQUFhO0FBRkEsR0FBZixDQURLLEVBS0wsRUFMSyxDQUFQO0FBT0Q7O0FBU0QsZUFBZSxtQkFBZixDQUFtQyxJQUFuQyxFQUFpRCxhQUFqRCxFQUFzRTtBQUNwRSxRQUFNLE9BQU8sR0FBRyxNQUFNLFdBQUEsQ0FBQSxZQUFBLENBQWEsSUFBYixDQUF0QjtBQUNBLFFBQU0sYUFBYSxHQUFHLE9BQU8sQ0FBQyxNQUFSLElBQWtCLEVBQXhDO0FBQ0EsUUFBTSxlQUFlLEdBQW9CO0FBQ3ZDLElBQUEsTUFBTSxFQUFFLEVBRCtCO0FBRXZDLElBQUEsSUFBSSxFQUFFO0FBRmlDLEdBQXpDOztBQUlBLE9BQUssTUFBTSxHQUFYLElBQWtCLE1BQU0sQ0FBQyxJQUFQLENBQVksYUFBWixDQUFsQixFQUE4QztBQUM1QyxJQUFBLGVBQWUsQ0FBQyxNQUFoQixDQUF1QixHQUF2QixJQUE4QixJQUFJLENBQUMsS0FBTCxDQUFXLE9BQU8sQ0FBQyxNQUFSLENBQWUsR0FBZixDQUFYLENBQTlCO0FBQ0Q7O0FBQ0QsRUFBQSxlQUFlLENBQUMsSUFBaEIsR0FBdUIsSUFBSSxDQUFDLEtBQUwsQ0FBVyxPQUFPLENBQUMsYUFBRCxDQUFsQixDQUF2QjtBQUNBLFNBQU8sZUFBUDtBQUNEOztBQVFELFNBQVMsR0FBVCxDQUFhLEdBQWIsRUFBdUIsSUFBdkIsRUFBcUM7QUFDbkMsTUFBSSxHQUFHLEdBQUcsR0FBVjs7QUFDQSxPQUFLLE1BQU0sSUFBWCxJQUFtQixJQUFuQixFQUF5QjtBQUN2QixJQUFBLEdBQUcsR0FBRyxHQUFHLENBQUMsSUFBRCxDQUFUOztBQUNBLFFBQUksQ0FBQyxHQUFMLEVBQVU7QUFDUixhQUFPLFNBQVA7QUFDRDtBQUNGOztBQUNELFNBQU8sR0FBUDtBQUNEIiwic291cmNlUm9vdCI6IiJ9